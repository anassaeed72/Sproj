Modern malwares are growing powerful and more sophisticated day by day. It has also been very common to see these malwares compromise the security tools along with the machine. The host based IDS tools are, therefore, not able to satisfy the security requirement of  todayâ€™s computer systems. Moreover, they are ineffective to detect rootkits, sophisticated keyloggers and network based attacks. The problem of  host based security tools is that they run inside the same hosts they are protecting which makes them directly exposed to malware. The traditional solution to this approach has been to move the security system into network to provide isolation. But, this comes at the cost of low visibility of the OS state of the host machine. Hence, this gives attacker more room to play their tricks and compromise the system.

Drawbacks of Host based as well as Network based Intrusion Detection System has brought IDS mechanism built on Virtual Machine Introspection as a popular framework. This project aimed to design a framework using Virtual Machine Introspection to protect Virtual Machines running on a physical machine. Virtual machine introspection (VMI) is a technique for externally monitoring the runtime state of a system-level virtual machine. Monitors can be placed in another virtual machine, within the hypervisor, or within any other part of the virtualization architecture. Such an approach helps to shield the Intrusion Detection System even if the Virtual Machine gets compromised. At the same time it allows us to view and control the virtual machine from outside of  VM. Security policy enforcement and threat detection is an essential goal of Virtual Machine introspection.

However, the problem with using VMI is of the semantic gap. Semantic gap is precisely the difference between getting between the low level memory state of the VM and the high level/meaningful  OS view of the VM. The figure below depicts the problem. On the right side we have the raw memory which will be useless for the VMI framework by itself and on the left hand side we see an attempt to create some semantic meaning out of that memory dump.

Reconstructing high level state information such as knowing the processes running, sockets opened from the low level state has been made easier by memory forensics tools such as volatility and rekall.

Our framework uses XEN as the hypervisor, along with libvmi which is a library for VMI which powers the hypervisor to access and control the state of the virtual machines. For reconstructing the OS level view of the VM we are using memory forensics tool called Volatility.

The diagram below gives a high level view of the framework:
  

All in all the monitor sits at the hypervisor level and peeks into host using libvmi. Once  state of the host has been captured we leverage volatility to track specific indicators particularly those which may go undetected by host based IDS. For example, threats that act as a lie detector are difficult to be detected without cross matching the output of multiple plugins of Volatility. 

In our senior year project we have researched, designed and implemented Grizzly which is an automated malware detection framework based up virtual machine introspection. VMI gives us the ability to gather accurate information from the outside the system due to which it makes uses of the advantages of both HIDS and NIDS while avoiding their disadvantages. Grizzly provides automated signature based malware detection based upon VMI where the signature can be defined in a high level language and hence the complexity is reduced as it is delegated to the framework. We believe that such frameworks can be deployed as as service in public clouds for malware detection using VMI.
